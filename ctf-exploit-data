# FLAG ADDRESSES:

Write flag address: ffffffff826279a8    64279a8    0x64279a8
Read flag address: ffffffff82b5ee10     695ee10    0x695ee10

Write flag address w/ KASLR: 0x026279a8
Read flag address w/ KASLR: 0x02b5ee10

# GUEST VM RAM REGIONS (from /proc/iomem):

00001000-0009fbff : System RAM
00100000-7fff9fff : System RAM
100000000-17fffffff : System RAM


# VULNERABLE COMMAND

kvm_prober readmmio_buf 0x17fffffff 64
Killed

# DMESG OUTPUT

[ 2934.838814] {MODULE_NAME}: IOCTL ENTRY! cmd=0xc0286b20, arg=0x7ffe9ee64390. ktime=2935106357179
[ 2934.838944] BUG: unable to handle page fault for address: ffffea0006000000
[ 2934.839002] #PF: supervisor read access in kernel mode
[ 2934.839059] #PF: error_code(0x0000) - not-present page
[ 2934.839126] PGD 17ffc8067 P4D 17ffc8067 PUD 17ffc7067 PMD 0
[ 2934.839188] Oops: 0000 [#4] PREEMPT SMP NOPTI
[ 2934.839245] CPU: 1 PID: 27821 Comm: kvm_prober Tainted: G      D W  OE      6.1.0-21-amd64 #1  Debian 6.1.90-1
[ 2934.839315] Hardware name: Red Hat KVM/RHEL, BIOS 1.16.3-2.el9 04/01/2014
[ 2934.839373] RIP: 0010:memtype_reserve+0x1d1/0x2c0
[ 2934.839438] Code: e8 0c 49 c1 e9 0c 4d 39 c8 0f 83 d3 00 00 00 48 8b 0d e3 d9 37 01 4c 89 c0 4c 89 ce 48 c1 e0 06 48 c1 e6 06 48 01 c8 48 01 ce <48> 8b 10 81 e2 00 08 40 00 0f 85 b3 82 95 00 48 83 c0 40 48 39 f0
[ 2934.839505] RSP: 0018:ffffc90005a17c08 EFLAGS: 00010287
[ 2934.839564] RAX: ffffea0006000000 RBX: 0000000180000fff RCX: ffffea0000000000
[ 2934.839620] RDX: 0000000000000000 RSI: ffffea0006000040 RDI: ffffffff83f75810
[ 2934.839677] RBP: 000000017ffff000 R08: 000000000017ffff R09: 0000000000180001
[ 2934.839732] R10: 0000000000000003 R11: ffffffff82ac7ae8 R12: ffffc90005a17c7c
[ 2934.839787] R13: 0000000000000002 R14: ffff8880596ca000 R15: 0000000180001000
[ 2934.839844] FS:  00007f78e79f6740(0000) GS:ffff88817bc80000(0000) knlGS:0000000000000000
[ 2934.839906] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 2934.839963] CR2: ffffea0006000000 CR3: 00000000048e8004 CR4: 00000000003706e0
[ 2934.840021] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 2934.840077] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 2934.840140] Call Trace:
[ 2934.840201]  <TASK>
[ 2934.840263]  ? __die_body.cold+0x1a/0x1f
[ 2934.840323]  ? page_fault_oops+0xd2/0x2b0
[ 2934.840382]  ? exc_page_fault+0xca/0x170
[ 2934.840443]  ? asm_exc_page_fault+0x22/0x30
[ 2934.840506]  ? memtype_reserve+0x1d1/0x2c0
[ 2934.840563]  ? memtype_reserve+0xcb/0x2c0
[ 2934.840618]  __ioremap_caller+0xf0/0x360
[ 2934.840684]  ? driver_ioctl+0x25c/0x7d1 [kvm_probe_drv]
[ 2934.840747]  ? _printk+0x68/0x83
[ 2934.840805]  driver_ioctl+0x25c/0x7d1 [kvm_probe_drv]
[ 2934.840865]  __x64_sys_ioctl+0x8d/0xd0
[ 2934.841754]  do_syscall_64+0x55/0xb0
[ 2934.841831]  ? page_add_new_anon_rmap+0x6c/0x120
[ 2934.841889]  ? _raw_spin_unlock+0xa/0x30
[ 2934.841947]  ? __handle_mm_fault+0xd90/0xfa0
[ 2934.842008]  ? handle_mm_fault+0xdb/0x2d0
[ 2934.842064]  ? do_user_addr_fault+0x1b0/0x580
[ 2934.842136]  ? clear_bhb_loop+0x15/0x70
[ 2934.842193]  ? clear_bhb_loop+0x15/0x70
[ 2934.842248]  ? clear_bhb_loop+0x15/0x70
[ 2934.842305]  ? clear_bhb_loop+0x15/0x70
[ 2934.842361]  ? clear_bhb_loop+0x15/0x70
[ 2934.842416]  entry_SYSCALL_64_after_hwframe+0x6e/0xd8
[ 2934.842474] RIP: 0033:0x7f78e7af6d1b
[ 2934.842536] Code: 00 48 89 44 24 18 31 c0 48 8d 44 24 60 c7 04 24 10 00 00 00 48 89 44 24 08 48 8d 44 24 20 48 89 44 24 10 b8 10 00 00 00 0f 05 <89> c2 3d 00 f0 ff ff 77 1c 48 8b 44 24 18 64 48 2b 04 25 28 00 00
[ 2934.842603] RSP: 002b:00007ffe9ee64310 EFLAGS: 00000246 ORIG_RAX: 0000000000000010
[ 2934.842665] RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 00007f78e7af6d1b
[ 2934.842723] RDX: 00007ffe9ee64390 RSI: 00000000c0286b20 RDI: 0000000000000003
[ 2934.842778] RBP: 00007ffe9ee64390 R08: 00007f78e7bcbc78 R09: 0000000000021001
[ 2934.842835] R10: 00007f78e7a10378 R11: 0000000000000246 R12: 00007ffe9ee64508
[ 2934.842891] R13: 00007ffe9ee64e15 R14: 0000562aba776dd8 R15: 00007f78e7c14020
[ 2934.842948]  </TASK>
[ 2934.843006] Modules linked in: kvm_probe_drv(OE) vhost_net tun tap vhost_vsock vmw_vsock_virtio_transport_common vhost vhost_iotlb vsock binfmt_misc intel_rapl_msr intel_rapl_common intel_uncore_frequency_common isst_if_common nfit libnvdimm kvm_intel kvm irqbypass ghash_clmulni_intel sha512_ssse3 sha512_generic sha256_ssse3 sha1_ssse3 aesni_intel crypto_simd cryptd iTCO_wdt rapl intel_pmc_bxt iTCO_vendor_support pcspkr watchdog virtio_rng virtio_console button joydev evdev serio_raw sg loop drm efi_pstore fuse dm_mod configfs qemu_fw_cfg ip_tables x_tables autofs4 ext4 crc16 mbcache jbd2 crc32c_generic sr_mod cdrom ahci libahci virtio_net net_failover virtio_blk libata failover crct10dif_pclmul crct10dif_common crc32_pclmul xhci_pci scsi_mod xhci_hcd crc32c_intel psmouse i2c_i801 scsi_common i2c_smbus usbcore lpc_ich virtio_pci virtio_pci_legacy_dev virtio_pci_modern_dev virtio virtio_ring usb_common
[ 2934.843296] CR2: ffffea0006000000
[ 2934.843356] ---[ end trace 0000000000000000 ]---
[ 2934.843412] RIP: 0010:memtype_reserve+0x1d1/0x2c0
[ 2934.843470] Code: e8 0c 49 c1 e9 0c 4d 39 c8 0f 83 d3 00 00 00 48 8b 0d e3 d9 37 01 4c 89 c0 4c 89 ce 48 c1 e0 06 48 c1 e6 06 48 01 c8 48 01 ce <48> 8b 10 81 e2 00 08 40 00 0f 85 b3 82 95 00 48 83 c0 40 48 39 f0
[ 2934.843537] RSP: 0018:ffffc90000cefb60 EFLAGS: 00010287
[ 2934.843594] RAX: ffffea0006000000 RBX: 0000000180000fff RCX: ffffea0000000000
[ 2934.843649] RDX: 0000000000000000 RSI: ffffea0006000040 RDI: ffffffff83f75810
[ 2934.843705] RBP: 000000017ffff000 R08: 000000000017ffff R09: 0000000000180001
[ 2934.843761] R10: 0000000000000003 R11: ffffffff82ac8b20 R12: ffffc90000cefbd4
[ 2934.843816] R13: 0000000000000002 R14: ffff8881038b7400 R15: 0000000180001000
[ 2934.843873] FS:  00007f78e79f6740(0000) GS:ffff88817bc80000(0000) knlGS:0000000000000000
[ 2934.843934] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 2934.843990] CR2: ffffea0006000000 CR3: 00000000048e8004 CR4: 00000000003706e0
[ 2934.844048] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 2934.844103] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 2934.844168] note: kvm_prober[27821] exited with irqs disabled
